<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="color-scheme" content="dark" />
  <title>Compliment Generator | Portfolio Project</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Poppins:wght@600;700&display=swap"
    rel="stylesheet"
  />

  <style>
    :root{
      /* Palette (Option 1) */
      --bg: #0F172A;
      --surface: #111827;
      --primary: #38BDF8;
      --secondary: #22C55E;
      --text: #F8FAFC;
      --muted: #94A3B8;

      --danger: #FB7185;
      --warning: #FBBF24;

      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --shadow-soft: 0 10px 22px rgba(0,0,0,.22);
      --radius: 18px;

      --ring: 0 0 0 3px rgba(56,189,248,.25);
      --ring-strong: 0 0 0 3px rgba(56,189,248,.35);
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body{
      margin: 0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 600px at 15% -10%, rgba(56,189,248,.18), transparent 55%),
                  radial-gradient(900px 450px at 110% 10%, rgba(34,197,94,.14), transparent 55%),
                  var(--bg);
      color: var(--text);
      line-height: 1.45;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    a{ color: inherit; }

    .container{
      width: min(1060px, 92vw);
      margin: 0 auto;
      padding: 28px 0 64px;
    }

    header{
      display: grid;
      gap: 12px;
      padding: 22px 18px 12px;
      margin-bottom: 14px;
    }

    .kicker{
      display: inline-flex;
      gap: 8px;
      align-items: center;
      color: var(--muted);
      font-size: 0.95rem;
    }

    .pill{
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 7px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(148,163,184,.18);
      width: fit-content;
    }

    .dot{
      width: 8px; height: 8px; border-radius: 99px;
      background: var(--secondary);
      box-shadow: 0 0 0 3px rgba(34,197,94,.15);
    }

    h1{
      font-family: Poppins, Inter, system-ui, sans-serif;
      margin: 0;
      letter-spacing: -0.02em;
      font-size: clamp(1.7rem, 2.2vw + 1rem, 3rem);
      line-height: 1.12;
    }

    .subhead{
      color: var(--muted);
      margin: 0;
      max-width: 70ch;
      font-size: 1.02rem;
    }

    .grid{
      display: grid;
      gap: 18px;
      grid-template-columns: 1fr;
      align-items: start;
      margin-top: 14px;
    }

    @media (min-width: 920px){
      .grid{ grid-template-columns: 420px 1fr; }
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border: 1px solid rgba(148,163,184,.16);
      border-radius: var(--radius);
      box-shadow: var(--shadow-soft);
      overflow: hidden;
    }

    .card-inner{
      padding: 16px;
    }

    .card h2{
      font-family: Poppins, Inter, system-ui, sans-serif;
      margin: 0 0 10px;
      font-size: 1.05rem;
      letter-spacing: -0.01em;
    }

    .muted{ color: var(--muted); }

    .stack{ display: grid; gap: 10px; }

    label{
      display: grid;
      gap: 7px;
      font-size: .95rem;
      color: var(--muted);
    }

    input, select, button, textarea{
      font: inherit;
      color: var(--text);
    }

    input, select{
      width: 100%;
      padding: 12px 12px;
      border-radius: 12px;
      border: 1px solid rgba(148,163,184,.22);
      background: rgba(17,24,39,.65);
      outline: none;
      transition: transform .15s ease, border-color .15s ease, box-shadow .15s ease;
    }

    input::placeholder{ color: rgba(148,163,184,.65); }

    input:focus, select:focus{
      border-color: rgba(56,189,248,.7);
      box-shadow: var(--ring);
    }

    .row{
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }

    @media (min-width: 560px){
      .row{ grid-template-columns: 1fr 1fr; }
    }

    .actions{
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
      margin-top: 6px;
    }

    @media (min-width: 560px){
      .actions{ grid-template-columns: 1.2fr 1fr 1fr; }
    }

    .btn{
      border: 1px solid rgba(148,163,184,.22);
      background: rgba(255,255,255,.04);
      border-radius: 14px;
      padding: 12px 12px;
      cursor: pointer;
      transition: transform .12s ease, box-shadow .12s ease, background-color .12s ease, border-color .12s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      font-weight: 600;
      user-select: none;
      position: relative;
      min-height: 46px;
    }

    .btn:focus{ outline: none; box-shadow: var(--ring-strong); }
    .btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.06); }
    .btn:active{ transform: translateY(0); }

    .btn-primary{
      border-color: rgba(56,189,248,.55);
      background: linear-gradient(180deg, rgba(56,189,248,.2), rgba(56,189,248,.08));
    }
    .btn-primary:hover{ border-color: rgba(56,189,248,.8); }

    .btn-secondary{
      border-color: rgba(34,197,94,.45);
      background: linear-gradient(180deg, rgba(34,197,94,.16), rgba(34,197,94,.06));
    }
    .btn-secondary:hover{ border-color: rgba(34,197,94,.75); }

    .btn-ghost{
      background: rgba(255,255,255,.03);
    }

    .btn[disabled]{
      opacity: .55;
      cursor: not-allowed;
      transform: none;
    }

    .kbd-hint{
      font-size: .85rem;
      color: rgba(148,163,184,.9);
      border: 1px solid rgba(148,163,184,.22);
      background: rgba(255,255,255,.03);
      border-radius: 10px;
      padding: 2px 8px;
      font-weight: 600;
    }

    .result{
      position: relative;
      min-height: 320px;
      display: grid;
      gap: 12px;
    }

    .result-top{
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 14px 16px 0;
    }

    .badge{
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,.18);
      background: rgba(255,255,255,.04);
      color: var(--muted);
      font-size: .92rem;
      width: fit-content;
      white-space: nowrap;
    }

    .badge strong{ color: var(--text); font-weight: 700; }

    .counter{
      font-variant-numeric: tabular-nums;
    }

    .result-body{
      padding: 0 16px 16px;
      display: grid;
      gap: 12px;
    }

    .compliment-box{
      border-radius: 16px;
      border: 1px solid rgba(148,163,184,.18);
      background: rgba(15,23,42,.35);
      padding: 16px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
      min-height: 160px;
      display: grid;
      gap: 10px;
      align-content: start;
      position: relative;
      overflow: hidden;
    }

    .compliment-text{
      font-size: clamp(1.1rem, 1vw + 1rem, 1.5rem);
      font-weight: 600;
      letter-spacing: -0.01em;
      margin: 0;
      opacity: 0;
      transform: translateY(6px);
      transition: opacity .22s ease, transform .22s ease;
    }

    .compliment-text.show{
      opacity: 1;
      transform: translateY(0);
    }

    .compliment-meta{
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      color: var(--muted);
      font-size: .92rem;
      opacity: 0;
      transform: translateY(6px);
      transition: opacity .22s ease, transform .22s ease;
    }
    .compliment-meta.show{ opacity: 1; transform: translateY(0); }

    .tag{
      border: 1px solid rgba(148,163,184,.18);
      background: rgba(255,255,255,.03);
      padding: 4px 10px;
      border-radius: 999px;
    }

    .empty-state{
      color: rgba(148,163,184,.95);
      display: grid;
      gap: 10px;
      align-content: center;
      justify-items: start;
      min-height: 160px;
    }

    .empty-title{
      font-family: Poppins, Inter, system-ui, sans-serif;
      margin: 0;
      font-size: 1.15rem;
      color: var(--text);
    }

    .empty-desc{
      margin: 0;
      max-width: 60ch;
    }

    .helper{
      font-size: .93rem;
      color: rgba(148,163,184,.95);
      margin: 0;
    }

    /* Loading shimmer */
    .shimmer{
      height: 18px;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(255,255,255,.04), rgba(255,255,255,.10), rgba(255,255,255,.04));
      background-size: 200% 100%;
      animation: shimmer 1.2s ease infinite;
    }
    .shimmer.lg{ height: 26px; border-radius: 14px; }
    @keyframes shimmer {
      0% { background-position: 0% 0; }
      100% { background-position: -200% 0; }
    }

    .divider{
      height: 1px;
      background: rgba(148,163,184,.14);
      margin: 2px 0 0;
    }

    /* Toast */
    .toast-wrap{
      position: fixed;
      bottom: 18px;
      left: 50%;
      transform: translateX(-50%);
      width: min(560px, calc(100vw - 32px));
      z-index: 1000;
      pointer-events: none;
    }

    .toast{
      pointer-events: none;
      display: grid;
      gap: 6px;
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid rgba(148,163,184,.22);
      background: rgba(17,24,39,.92);
      box-shadow: var(--shadow);
      opacity: 0;
      transform: translateY(10px);
      transition: opacity .18s ease, transform .18s ease;
    }
    .toast.show{
      opacity: 1;
      transform: translateY(0);
    }
    .toast .title{
      font-weight: 700;
      letter-spacing: -0.01em;
    }
    .toast .msg{ color: var(--muted); font-size: .95rem; }

    /* Favorites drawer */
    .drawer-backdrop{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.55);
      opacity: 0;
      pointer-events: none;
      transition: opacity .18s ease;
      z-index: 900;
    }
    .drawer-backdrop.show{
      opacity: 1;
      pointer-events: auto;
    }

    .drawer{
      position: fixed;
      right: 0;
      top: 0;
      height: 100%;
      width: min(520px, 92vw);
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border-left: 1px solid rgba(148,163,184,.18);
      box-shadow: -20px 0 50px rgba(0,0,0,.4);
      transform: translateX(102%);
      transition: transform .22s ease;
      z-index: 950;
      display: grid;
      grid-template-rows: auto auto 1fr auto;
    }

    .drawer.show{
      transform: translateX(0);
    }

    .drawer header{
      padding: 16px;
      margin: 0;
    }

    .drawer-title{
      font-family: Poppins, Inter, system-ui, sans-serif;
      font-size: 1.15rem;
      margin: 0;
    }

    .drawer-sub{
      margin: 6px 0 0;
      color: var(--muted);
      font-size: .95rem;
    }

    .drawer-actions{
      padding: 0 16px 12px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
    }

    .drawer-actions .btn{
      min-height: 42px;
      padding: 10px 12px;
    }

    .fav-list{
      padding: 12px 16px;
      overflow: auto;
      display: grid;
      gap: 10px;
    }

    .fav-item{
      border: 1px solid rgba(148,163,184,.18);
      border-radius: 16px;
      background: rgba(15,23,42,.35);
      padding: 12px;
      display: grid;
      gap: 10px;
    }

    .fav-item p{
      margin: 0;
      font-weight: 600;
      letter-spacing: -0.01em;
    }

    .fav-meta{
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      color: var(--muted);
      font-size: .9rem;
    }

    .fav-item .btn{
      justify-self: end;
      min-height: 38px;
      padding: 8px 10px;
    }

    .drawer footer{
      padding: 12px 16px 18px;
      border-top: 1px solid rgba(148,163,184,.14);
      color: var(--muted);
      font-size: .92rem;
    }

    /* Desktop hover polish */
    @media (hover:hover) and (pointer:fine){
      .card:hover{
        transform: translateY(-2px);
        transition: transform .18s ease, box-shadow .18s ease;
        box-shadow: var(--shadow);
      }
    }

    /* Reduce motion */
    @media (prefers-reduced-motion: reduce){
      * { animation: none !important; transition: none !important; scroll-behavior: auto !important; }
    }

    /* About section */
    .about{
      margin-top: 18px;
    }
    .about .card-inner{
      padding: 16px 16px 18px;
    }
    .about ul{
      margin: 10px 0 0;
      padding-left: 18px;
      color: rgba(148,163,184,.95);
      display: grid;
      gap: 8px;
    }

    /* Visually-hidden utility */
    .sr-only{
      position:absolute;
      width:1px;height:1px;
      padding:0;margin:-1px;
      overflow:hidden;
      clip:rect(0,0,0,0);
      white-space:nowrap;
      border:0;
    }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <div class="pill">
        <span class="dot" aria-hidden="true"></span>
        <span class="kicker">Portfolio Project ‚Ä¢ Product-minded UX ‚Ä¢ Vanilla JS</span>
      </div>
      <h1>Compliment Generator</h1>
      <p class="subhead">
        A calm, polished web app that creates personalized compliments with thoughtful UX,
        accessibility, and clean state management‚Äîbuilt with static HTML/CSS/JS.
      </p>
    </header>

    <main class="grid">
      <!-- Controls -->
      <section class="card" aria-label="Personalization controls">
        <div class="card-inner">
          <h2>Personalize (optional)</h2>
          <p class="helper">
            Tip: press <span class="kbd-hint">Enter</span> to generate when focused in a field.
          </p>

          <div class="stack" style="margin-top:12px;">
            <label for="nameInput">
              Name
              <input id="nameInput" name="name" type="text" autocomplete="given-name" placeholder="e.g., Hazem" />
            </label>

            <div class="row">
              <label for="forSelect">
                Who is this for?
                <select id="forSelect" name="audience">
                  <option value="">Surprise me</option>
                  <option>Developer</option>
                  <option>Designer</option>
                  <option>Student</option>
                  <option>Manager</option>
                  <option>Friend</option>
                </select>
              </label>

              <label for="toneSelect">
                Tone
                <select id="toneSelect" name="tone">
                  <option value="">Balanced</option>
                  <option>Professional</option>
                  <option>Friendly</option>
                  <option>Playful</option>
                </select>
              </label>
            </div>

            <label for="focusSelect">
              Focus
              <select id="focusSelect" name="focus">
                <option value="">Any focus</option>
                <option>Skills</option>
                <option>Effort</option>
                <option>Creativity</option>
                <option>Leadership</option>
                <option>Kindness</option>
              </select>
            </label>

            <div class="actions" role="group" aria-label="Actions">
              <button id="generateBtn" class="btn btn-primary" type="button">
                ‚ú® Generate Compliment
              </button>
              <button id="regenBtn" class="btn btn-ghost" type="button" disabled>
                üîÑ Regenerate
              </button>
              <button id="copyBtn" class="btn btn-ghost" type="button" disabled>
                üìã Copy
              </button>
            </div>

            <div class="actions" style="grid-template-columns: 1fr 1fr;">
              <button id="favoriteBtn" class="btn btn-secondary" type="button" disabled>
                üíö Save Favorite
              </button>
              <button id="openFavBtn" class="btn btn-ghost" type="button">
                ‚≠ê View Favorites
              </button>
            </div>

            <p class="helper">
              Saves locally in your browser (no backend). Great for showcasing product thinking without extra complexity.
            </p>
          </div>
        </div>
      </section>

      <!-- Result -->
      <section class="card result" aria-label="Generated compliment">
        <div class="result-top">
          <div class="badge" aria-live="polite">
            <span class="counter">Generated:</span>
            <strong id="countLabel">0</strong>
            <span class="muted">total</span>
          </div>

          <div class="badge" aria-live="polite">
            <span class="counter">Saved:</span>
            <strong id="savedLabel">0</strong>
          </div>
        </div>
        <div class="divider" aria-hidden="true"></div>

        <div class="result-body">
          <div id="complimentBox" class="compliment-box">
            <!-- Empty / loading / content inserted by JS -->
          </div>

          <p class="helper muted" id="hintLine">
            Your last compliment is saved automatically. Favorites are stored with tags.
          </p>
        </div>
      </section>
    </main>

    <!-- About / What this demonstrates -->
    <section class="card about" aria-label="About this project">
      <div class="card-inner">
        <h2>What this demonstrates</h2>
        <p class="muted" style="margin:0;">
          This project is intentionally simple for users, but strategically designed for reviewers.
        </p>
        <ul>
          <li><strong>UX + delight:</strong> meaningful copy, personalization, and calm visual hierarchy.</li>
          <li><strong>Accessibility:</strong> semantic structure, labels, keyboard flows, visible focus.</li>
          <li><strong>State management:</strong> single source of truth + predictable UI updates.</li>
          <li><strong>Reliability:</strong> localStorage persistence, copy fallback, error states.</li>
          <li><strong>Maintainable vanilla JS:</strong> small functions, clear naming, minimal globals.</li>
        </ul>
      </div>
    </section>
  </div>

  <!-- Toast -->
  <div class="toast-wrap" aria-live="polite" aria-atomic="true">
    <div id="toast" class="toast" role="status">
      <div class="title" id="toastTitle">Notice</div>
      <div class="msg" id="toastMsg">Message</div>
    </div>
  </div>

  <!-- Favorites Drawer -->
  <div id="drawerBackdrop" class="drawer-backdrop" tabindex="-1" aria-hidden="true"></div>

  <aside id="drawer" class="drawer" aria-label="Favorites panel" aria-hidden="true">
    <header>
      <h3 class="drawer-title">Favorites</h3>
      <p class="drawer-sub">Saved locally in your browser. You can copy or delete any favorite.</p>
    </header>

    <div class="drawer-actions">
      <button id="closeDrawerBtn" class="btn btn-ghost" type="button">‚úï Close</button>
      <button id="clearFavBtn" class="btn btn-ghost" type="button">üóëÔ∏è Clear all</button>
    </div>

    <div class="fav-list" id="favList" role="list">
      <!-- Favorites inserted by JS -->
    </div>

    <footer>
      <span class="muted">Tip:</span> Use favorites as ‚Äúproof of polish‚Äù when showing your portfolio live.
    </footer>
  </aside>

  <script>
    (function(){
      "use strict";

      /**
       * Minimal, maintainable vanilla JS architecture:
       * - Single app state object
       * - Small pure helpers
       * - DOM updates centralized
       */

      const STORAGE_KEYS = {
        last: "cg:lastCompliment:v1",
        favorites: "cg:favorites:v1",
        counters: "cg:counters:v1"
      };

      const $ = (sel, root=document) => root.querySelector(sel);

      const dom = {
        nameInput: $("#nameInput"),
        forSelect: $("#forSelect"),
        toneSelect: $("#toneSelect"),
        focusSelect: $("#focusSelect"),

        generateBtn: $("#generateBtn"),
        regenBtn: $("#regenBtn"),
        copyBtn: $("#copyBtn"),
        favoriteBtn: $("#favoriteBtn"),
        openFavBtn: $("#openFavBtn"),

        countLabel: $("#countLabel"),
        savedLabel: $("#savedLabel"),
        complimentBox: $("#complimentBox"),

        toast: $("#toast"),
        toastTitle: $("#toastTitle"),
        toastMsg: $("#toastMsg"),

        drawer: $("#drawer"),
        drawerBackdrop: $("#drawerBackdrop"),
        closeDrawerBtn: $("#closeDrawerBtn"),
        clearFavBtn: $("#clearFavBtn"),
        favList: $("#favList")
      };

      const app = {
        state: {
          lastCompliment: null, // { text, meta, id, createdAt }
          favorites: [],        // [{ id, text, meta, createdAt }]
          counters: { totalGenerated: 0 },
          recentIds: [],        // runtime only, to reduce repetition
          isLoading: false,
          toastTimer: null
        }
      };

      /* ---------------------------
         Copy Engine (high variety)
      ---------------------------- */

      const BANK = {
        openings: [
          "Quick note",
          "Just saying",
          "Honestly",
          "Small appreciation moment",
          "Here‚Äôs what stands out",
          "I noticed something",
          "Friendly reminder"
        ],
        closings: [
          "Keep going‚Äîyou‚Äôre onto something.",
          "You‚Äôre building momentum.",
          "That‚Äôs the kind of impact people remember.",
          "Don‚Äôt underestimate how valuable that is.",
          "You make hard things look doable.",
          "It shows‚Äîin the best way."
        ],
        focusPhrases: {
          Skills: [
            "your skill is sharp and deliberate",
            "your capability shows in the details",
            "you have a strong grasp of the craft",
            "you bring clarity to complex problems",
            "your technical judgment is genuinely solid"
          ],
          Effort: [
            "your consistency is impressive",
            "your follow-through is rare (and valuable)",
            "you show up with real effort",
            "you keep pushing even when it‚Äôs hard",
            "you‚Äôre putting in work that pays off"
          ],
          Creativity: [
            "your creativity has range",
            "you find angles others miss",
            "your ideas feel fresh and usable",
            "you combine taste with practicality",
            "you bring originality without losing clarity"
          ],
          Leadership: [
            "you create calm and direction",
            "you make the team better just by how you operate",
            "you lead with clarity and accountability",
            "people trust you for good reason",
            "you elevate the standards around you"
          ],
          Kindness: [
            "you make people feel seen",
            "your kindness is steady and real",
            "you raise the vibe without trying",
            "you‚Äôre thoughtful in a way that matters",
            "your presence is genuinely supportive"
          ]
        },
        audiencePhrases: {
          Developer: [
            "You write with intention‚Äîclean, understandable, and built to last.",
            "Your problem-solving is structured, and your execution is crisp.",
            "You balance speed with quality in a way that‚Äôs genuinely professional."
          ],
          Designer: [
            "Your eye for hierarchy and detail is excellent‚Äîeverything feels considered.",
            "You translate ideas into experiences people actually enjoy using.",
            "You have taste‚Äîand you back it up with thoughtful decisions."
          ],
          Student: [
            "You‚Äôre learning fast, and the progress is clearly visible.",
            "Your curiosity and effort are building real skill.",
            "You‚Äôre doing the hard part: showing up consistently."
          ],
          Manager: [
            "You create clarity and momentum‚Äîtwo things teams always need.",
            "You communicate in a way that moves work forward.",
            "You bring structure without killing creativity."
          ],
          Friend: [
            "You‚Äôre the kind of person people feel better around.",
            "You show up in ways that matter.",
            "You have a steady, positive energy that‚Äôs real."
          ]
        },
        toneAdjust: {
          Professional: {
            emoji: "‚úÖ",
            style: "direct",
            extra: [
              "Your work quality is consistently high.",
              "You‚Äôre dependable and results-oriented.",
              "You communicate clearly and execute cleanly."
            ]
          },
          Friendly: {
            emoji: "üåø",
            style: "warm",
            extra: [
              "You‚Äôre doing great‚Äîseriously.",
              "You‚Äôve got a good thing going.",
              "I‚Äôm glad people like you exist."
            ]
          },
          Playful: {
            emoji: "‚ú®",
            style: "playful",
            extra: [
              "Low-key iconic behavior.",
              "You‚Äôre kind of a big deal (in a good way).",
              "If excellence had a username, it‚Äôd be yours."
            ]
          },
          Balanced: {
            emoji: "üí´",
            style: "balanced",
            extra: [
              "You‚Äôre doing meaningful work.",
              "You have a strong, steady vibe.",
              "This is the kind of progress that compounds."
            ]
          }
        }
      };

      function pick(arr){
        return arr[Math.floor(Math.random() * arr.length)];
      }

      function cleanName(raw){
        const v = (raw || "").trim();
        if (!v) return "";
        // Keep it simple + safe; capitalize first letter
        return v.slice(0,1).toUpperCase() + v.slice(1);
      }

      function stableMeta(){
        const name = cleanName(dom.nameInput.value);
        const who = dom.forSelect.value.trim() || "";
        const tone = dom.toneSelect.value.trim() || "Balanced";
        const focus = dom.focusSelect.value.trim() || "";
        return { name, who, tone, focus };
      }

      function buildCompliment(meta){
        const tonePack = BANK.toneAdjust[meta.tone] || BANK.toneAdjust.Balanced;
        const opening = pick(BANK.openings);
        const closing = pick(BANK.closings);

        const whoLine = meta.who ? pick(BANK.audiencePhrases[meta.who] || []) : "";
        const focusLine = meta.focus ? pick(BANK.focusPhrases[meta.focus] || []) : "";
        const toneExtra = pick(tonePack.extra);

        const namePrefix = meta.name ? `${meta.name}, ` : "";

        // Compose in a natural, recruiter-friendly way:
        // - 1-2 short sentences + one strong line + a close.
        let core = [];

        // Opening line
        core.push(`${opening}: ${namePrefix}${toneExtra}`);

        // Specificity (who / focus)
        if (meta.who && whoLine) core.push(whoLine);

        if (meta.focus && focusLine){
          core.push(`Also‚Äî${meta.name ? "your" : "your"} ${focusLine}.`);
        } else {
          // Add a gentle, general strength if no focus chosen
          core.push("You have a way of making things clearer, calmer, and better.");
        }

        core.push(closing);

        // Clean spacing
        const text = core.join(" ").replace(/\s+/g, " ").trim();
        return { text, emoji: tonePack.emoji };
      }

      function createCompliment(meta){
        // Reduce repetition by re-rolling if the ID is recent.
        // ID is a hash-like string based on chosen phrases.
        for (let i = 0; i < 6; i++){
          const built = buildCompliment(meta);
          const id = simpleId(built.text);
          if (!app.state.recentIds.includes(id)){
            app.state.recentIds.unshift(id);
            app.state.recentIds = app.state.recentIds.slice(0, 12);
            return {
              id,
              text: built.text,
              meta: { ...meta, emoji: built.emoji },
              createdAt: Date.now()
            };
          }
        }
        // If we somehow keep repeating, just return the last built.
        const built = buildCompliment(meta);
        return {
          id: simpleId(built.text),
          text: built.text,
          meta: { ...meta, emoji: built.emoji },
          createdAt: Date.now()
        };
      }

      function simpleId(str){
        // Simple stable hash (non-crypto) for repeat detection
        let h = 2166136261;
        for (let i=0; i<str.length; i++){
          h ^= str.charCodeAt(i);
          h = Math.imul(h, 16777619);
        }
        return "c_" + (h >>> 0).toString(16);
      }

      /* ---------------------------
         Persistence
      ---------------------------- */

      function loadJSON(key, fallback){
        try{
          const raw = localStorage.getItem(key);
          if (!raw) return fallback;
          return JSON.parse(raw);
        }catch{
          return fallback;
        }
      }

      function saveJSON(key, value){
        try{
          localStorage.setItem(key, JSON.stringify(value));
          return true;
        }catch{
          return false;
        }
      }

      function hydrate(){
        app.state.lastCompliment = loadJSON(STORAGE_KEYS.last, null);
        app.state.favorites = loadJSON(STORAGE_KEYS.favorites, []);
        app.state.counters = loadJSON(STORAGE_KEYS.counters, { totalGenerated: 0 });

        // Defensive shape
        if (!app.state.counters || typeof app.state.counters.totalGenerated !== "number"){
          app.state.counters = { totalGenerated: 0 };
        }
        if (!Array.isArray(app.state.favorites)) app.state.favorites = [];
      }

      function persistAll(){
        saveJSON(STORAGE_KEYS.last, app.state.lastCompliment);
        saveJSON(STORAGE_KEYS.favorites, app.state.favorites);
        saveJSON(STORAGE_KEYS.counters, app.state.counters);
      }

      /* ---------------------------
         UI: Toast
      ---------------------------- */

      function showToast(title, msg){
        clearTimeout(app.state.toastTimer);
        dom.toastTitle.textContent = title;
        dom.toastMsg.textContent = msg;
        dom.toast.classList.add("show");
        app.state.toastTimer = setTimeout(() => dom.toast.classList.remove("show"), 2200);
      }

      /* ---------------------------
         UI: Result Rendering
      ---------------------------- */

      function setButtonsEnabled(hasCompliment){
        dom.regenBtn.disabled = !hasCompliment || app.state.isLoading;
        dom.copyBtn.disabled = !hasCompliment || app.state.isLoading;
        dom.favoriteBtn.disabled = !hasCompliment || app.state.isLoading;
        dom.generateBtn.disabled = app.state.isLoading;
      }

      function renderCounters(){
        dom.countLabel.textContent = String(app.state.counters.totalGenerated || 0);
        dom.savedLabel.textContent = String(app.state.favorites.length);
      }

      function renderEmpty(){
        dom.complimentBox.innerHTML = `
          <div class="empty-state">
            <p class="empty-title">Generate your first compliment ‚ú®</p>
            <p class="empty-desc">
              Add a name or choose options‚Äîor just press <span class="kbd-hint">Generate</span> and let it surprise you.
            </p>
            <div class="muted" style="display:flex; gap:8px; flex-wrap:wrap;">
              <span class="tag">High-variance copy</span>
              <span class="tag">Optional personalization</span>
              <span class="tag">Favorites + localStorage</span>
            </div>
          </div>
        `;
      }

      function renderLoading(){
        dom.complimentBox.innerHTML = `
          <div class="stack" style="padding:4px 2px;">
            <div class="shimmer lg" style="width: 90%;"></div>
            <div class="shimmer" style="width: 65%;"></div>
            <div class="shimmer" style="width: 80%;"></div>
            <div class="shimmer" style="width: 50%;"></div>
            <div class="muted" style="margin-top:6px; font-size:.92rem;">Crafting something kind‚Ä¶</div>
          </div>
        `;
      }

      function renderCompliment(c){
        const { name, who, tone, focus, emoji } = c.meta || {};
        const tags = [
          tone ? `Tone: ${tone}` : null,
          who ? `For: ${who}` : null,
          focus ? `Focus: ${focus}` : null,
          name ? `Name: ${name}` : null
        ].filter(Boolean);

        dom.complimentBox.innerHTML = `
          <p class="compliment-text" id="complimentText">
            <span aria-hidden="true">${emoji || "üí´"}</span> ${escapeHTML(c.text)}
          </p>
          <div class="compliment-meta" id="complimentMeta">
            ${tags.map(t => `<span class="tag">${escapeHTML(t)}</span>`).join("")}
          </div>
        `;

        // Trigger micro-animation after paint
        requestAnimationFrame(() => {
          const t = $("#complimentText");
          const m = $("#complimentMeta");
          if (t) t.classList.add("show");
          if (m) m.classList.add("show");
        });
      }

      function escapeHTML(str){
        return String(str)
          .replaceAll("&","&amp;")
          .replaceAll("<","&lt;")
          .replaceAll(">","&gt;")
          .replaceAll('"',"&quot;")
          .replaceAll("'","&#039;");
      }

      /* ---------------------------
         Favorites Drawer
      ---------------------------- */

      function openDrawer(){
        dom.drawer.classList.add("show");
        dom.drawerBackdrop.classList.add("show");
        dom.drawer.setAttribute("aria-hidden", "false");
        dom.drawerBackdrop.setAttribute("aria-hidden", "false");
        renderFavorites();
        // Focus the close button for accessibility
        setTimeout(() => dom.closeDrawerBtn.focus(), 0);
      }

      function closeDrawer(){
        dom.drawer.classList.remove("show");
        dom.drawerBackdrop.classList.remove("show");
        dom.drawer.setAttribute("aria-hidden", "true");
        dom.drawerBackdrop.setAttribute("aria-hidden", "true");
        // Return focus to the opener
        setTimeout(() => dom.openFavBtn.focus(), 0);
      }

      function renderFavorites(){
        const list = app.state.favorites.slice().sort((a,b) => b.createdAt - a.createdAt);

        if (list.length === 0){
          dom.favList.innerHTML = `
            <div class="fav-item" role="listitem">
              <p>No favorites yet.</p>
              <div class="fav-meta">
                <span class="tag">Generate</span>
                <span class="tag">Save</span>
                <span class="tag">Build your set</span>
              </div>
            </div>
          `;
          return;
        }

        dom.favList.innerHTML = list.map(item => {
          const tags = [];
          if (item.meta?.tone) tags.push(`Tone: ${item.meta.tone}`);
          if (item.meta?.who) tags.push(`For: ${item.meta.who}`);
          if (item.meta?.focus) tags.push(`Focus: ${item.meta.focus}`);
          if (item.meta?.name) tags.push(`Name: ${item.meta.name}`);

          return `
            <div class="fav-item" role="listitem" data-id="${item.id}">
              <p>${escapeHTML(item.text)}</p>
              <div class="fav-meta">${tags.map(t => `<span class="tag">${escapeHTML(t)}</span>`).join("")}</div>
              <div style="display:flex; gap:10px; justify-content:flex-end; flex-wrap:wrap;">
                <button class="btn btn-ghost" type="button" data-action="copy" data-id="${item.id}">üìã Copy</button>
                <button class="btn btn-ghost" type="button" data-action="delete" data-id="${item.id}">üóëÔ∏è Delete</button>
              </div>
            </div>
          `;
        }).join("");
      }

      /* ---------------------------
         Clipboard
      ---------------------------- */

      async function copyToClipboard(text){
        // Prefer async clipboard
        if (navigator.clipboard && window.isSecureContext){
          await navigator.clipboard.writeText(text);
          return true;
        }

        // Fallback
        const ta = document.createElement("textarea");
        ta.value = text;
        ta.setAttribute("readonly", "");
        ta.style.position = "fixed";
        ta.style.left = "-9999px";
        ta.style.top = "-9999px";
        document.body.appendChild(ta);
        ta.select();
        let ok = false;
        try{
          ok = document.execCommand("copy");
        }catch{
          ok = false;
        }
        document.body.removeChild(ta);
        return ok;
      }

      /* ---------------------------
         Core Actions
      ---------------------------- */

      function simulateDelay(){
        // 250‚Äì600ms polish delay
        return 250 + Math.floor(Math.random() * 351);
      }

      async function generate(isRegenerate){
        if (app.state.isLoading) return;

        const meta = stableMeta();

        // If it's a regenerate, keep the last meta stable
        const useMeta = (isRegenerate && app.state.lastCompliment?.meta)
          ? { ...app.state.lastCompliment.meta, ...meta } // allow updated inputs if user changed them
          : meta;

        app.state.isLoading = true;
        setButtonsEnabled(!!app.state.lastCompliment);
        renderLoading();

        const t0 = performance.now();
        await wait(simulateDelay());
        const c = createCompliment(useMeta);
        const t1 = performance.now();

        // Update state
        app.state.lastCompliment = c;
        app.state.counters.totalGenerated = (app.state.counters.totalGenerated || 0) + 1;
        persistAll();

        // Render
        renderCompliment(c);
        renderCounters();
        setButtonsEnabled(true);

        app.state.isLoading = false;
        setButtonsEnabled(true);

        // Small, subtle transparency for reviewers: show timing without being "too much"
        const ms = Math.max(0, Math.round(t1 - t0));
        showToast("Generated", `New compliment ready (rendered in ~${ms}ms).`);
      }

      function wait(ms){
        return new Promise(res => setTimeout(res, ms));
      }

      function isAlreadyFavorite(id){
        return app.state.favorites.some(f => f.id === id);
      }

      function saveFavorite(){
        const c = app.state.lastCompliment;
        if (!c) return;

        if (isAlreadyFavorite(c.id)){
          showToast("Already saved", "That compliment is already in your favorites.");
          return;
        }

        app.state.favorites.push({
          id: c.id,
          text: c.text,
          meta: c.meta,
          createdAt: c.createdAt
        });

        // Persist & update UI
        persistAll();
        renderCounters();
        showToast("Saved", "Added to favorites.");
      }

      async function copyCurrent(){
        const c = app.state.lastCompliment;
        if (!c) return;

        try{
          const ok = await copyToClipboard(c.text);
          if (ok) showToast("Copied", "Compliment copied to clipboard.");
          else showToast("Copy failed", "Your browser blocked clipboard access.");
        }catch{
          showToast("Copy failed", "Clipboard permission was denied.");
        }
      }

      /* ---------------------------
         Events
      ---------------------------- */

      function onKeydown(e){
        // Close drawer with Escape
        if (e.key === "Escape" && dom.drawer.classList.contains("show")){
          e.preventDefault();
          closeDrawer();
          return;
        }

        // Generate with Enter (when in a field) for smoother UX
        if (e.key === "Enter"){
          const active = document.activeElement;
          const isInput = active && (active.tagName === "INPUT" || active.tagName === "SELECT");
          if (isInput){
            e.preventDefault();
            generate(false);
          }
        }
      }

      function wireEvents(){
        dom.generateBtn.addEventListener("click", () => generate(false));
        dom.regenBtn.addEventListener("click", () => generate(true));
        dom.copyBtn.addEventListener("click", copyCurrent);
        dom.favoriteBtn.addEventListener("click", saveFavorite);

        dom.openFavBtn.addEventListener("click", openDrawer);
        dom.closeDrawerBtn.addEventListener("click", closeDrawer);
        dom.drawerBackdrop.addEventListener("click", closeDrawer);

        dom.clearFavBtn.addEventListener("click", () => {
          if (app.state.favorites.length === 0){
            showToast("Nothing to clear", "No favorites saved yet.");
            return;
          }
          app.state.favorites = [];
          persistAll();
          renderCounters();
          renderFavorites();
          showToast("Cleared", "Favorites removed.");
        });

        // Delegated actions inside favorites list
        dom.favList.addEventListener("click", async (e) => {
          const btn = e.target.closest("button");
          if (!btn) return;

          const action = btn.getAttribute("data-action");
          const id = btn.getAttribute("data-id");
          const item = app.state.favorites.find(f => f.id === id);
          if (!item) return;

          if (action === "delete"){
            app.state.favorites = app.state.favorites.filter(f => f.id !== id);
            persistAll();
            renderCounters();
            renderFavorites();
            showToast("Deleted", "Removed from favorites.");
          }

          if (action === "copy"){
            try{
              const ok = await copyToClipboard(item.text);
              if (ok) showToast("Copied", "Favorite copied to clipboard.");
              else showToast("Copy failed", "Your browser blocked clipboard access.");
            }catch{
              showToast("Copy failed", "Clipboard permission was denied.");
            }
          }
        });

        document.addEventListener("keydown", onKeydown);

        // Keep button states in sync with input changes (optional polish)
        ["input","change"].forEach(evt => {
          dom.nameInput.addEventListener(evt, syncButtons);
          dom.forSelect.addEventListener(evt, syncButtons);
          dom.toneSelect.addEventListener(evt, syncButtons);
          dom.focusSelect.addEventListener(evt, syncButtons);
        });
      }

      function syncButtons(){
        const has = !!app.state.lastCompliment;
        setButtonsEnabled(has);
      }

      /* ---------------------------
         Init
      ---------------------------- */

      function init(){
        hydrate();
        renderCounters();

        if (app.state.lastCompliment){
          renderCompliment(app.state.lastCompliment);
          setButtonsEnabled(true);
        } else {
          renderEmpty();
          setButtonsEnabled(false);
        }

        wireEvents();
      }

      init();
    })();
  </script>
</body>
</html>

