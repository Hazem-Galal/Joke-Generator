<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Compliment & Joke Card</title>

  <!-- Font Awesome -->
  <link rel="preconnect" href="https://cdnjs.cloudflare.com">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

  <style>
    :root{
      /* Playing card ratio 2.5x3.5 => 5:7 */
      --card-w: 360px;
      --card-h: 504px;

      /* ===== Color scheme (from your reference image) ===== */
      --bg-a: #BFE8E3;      /* soft mint/teal */
      --bg-b: #CFE6F6;      /* airy blue */
      --bg-c: #F6D6E6;      /* pastel pink */
      --bg-d: #D6F4EA;      /* pale mint */

      --card: #FFFFFF;      /* clean white card */
      --card-edge: rgba(30, 41, 59, 0.10);
      --shadow: 0 22px 60px rgba(15, 23, 42, 0.22);

      --text: #111827;      /* near-black */
      --muted: #475569;     /* slate */

      --chip-bg: rgba(255,255,255,0.75);
      --chip-br: rgba(15,23,42,0.10);

      --panel-bg: rgba(15,23,42,0.04);
      --panel-br: rgba(15,23,42,0.10);

      --btn-bg: rgba(255,255,255,0.78);
      --btn-br: rgba(15,23,42,0.14);

      --accent-green: #7CFF9B;
      --accent-green-2: #5CFF86;

      --radius: 22px;
      --card-radius: 26px;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }

    body{
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color: var(--text);
      overflow-x: hidden;

      /* Pastel gradient background like your reference */
      background: radial-gradient(1200px 800px at 20% 20%, var(--bg-d), transparent 55%),
                  radial-gradient(1100px 700px at 85% 30%, var(--bg-c), transparent 55%),
                  radial-gradient(1200px 800px at 50% 95%, var(--bg-b), transparent 50%),
                  linear-gradient(120deg, var(--bg-a), var(--bg-b));
      background-size: 100% 100%;
      position: relative;
    }

    /* Floating pastel shapes (similar vibe to the reference) */
    .bg-shapes{
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 0;
      overflow: hidden;
    }
    .shape{
      position: absolute;
      opacity: 0.55;
      filter: blur(0.2px);
      transform: translateZ(0);
      animation: drift 12s ease-in-out infinite alternate;
    }
    .shape.circle{ border-radius: 999px; }
    .shape.square{ border-radius: 12px; transform: rotate(12deg); }
    .shape.dot{ border-radius: 999px; opacity: .38; }

    @keyframes drift{
      from{ transform: translate3d(0,0,0) rotate(0deg); }
      to{ transform: translate3d(24px,-18px,0) rotate(10deg); }
    }

    /* Layout */
    .page{
      min-height: 100%;
      display: grid;
      place-items: center;
      padding: 28px 16px 34px;
      position: relative;
      z-index: 1;
    }

    .wrap{
      width: 100%;
      max-width: 980px;
      display: grid;
      gap: 16px;
      place-items: center;
    }

    h1{
      margin: 0;
      font-size: clamp(28px, 4.2vw, 48px);
      letter-spacing: .2px;
      line-height: 1.05;
      text-align: center;
      color: #0f172a;
      text-shadow: 0 1px 0 rgba(255,255,255,0.45);
    }
    .subtitle{
      margin: 0;
      text-align: center;
      max-width: 70ch;
      color: rgba(15,23,42,.72);
      line-height: 1.45;
    }

    /* Card */
    .card{
      width: var(--card-w);
      height: var(--card-h);
      border-radius: var(--card-radius);
      background: var(--card);
      border: 1px solid var(--card-edge);
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden; /* important for badge cropping */
    }

    /* Soft internal highlight */
    .card::before{
      content:"";
      position:absolute;
      inset:0;
      pointer-events:none;
      background:
        radial-gradient(600px 240px at 40% 0%, rgba(255,255,255,0.90), rgba(255,255,255,0.00) 55%),
        linear-gradient(180deg, rgba(255,255,255,0.65), rgba(255,255,255,0.00) 60%);
      opacity: .65;
      z-index: 0;
    }

    /* Corner badges like the reference (green circles w/ star) */
    .badge{
      position:absolute;
      width: 64px;
      height: 64px;
      border-radius: 999px;
      display: grid;
      place-items: center;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.55), rgba(255,255,255,0.00) 55%),
                  linear-gradient(180deg, var(--accent-green), var(--accent-green-2));
      box-shadow:
        0 14px 26px rgba(15,23,42,0.18),
        0 0 0 1px rgba(15,23,42,0.08) inset;
      z-index: 2;
      user-select: none;
    }
    .badge.top-right{ top: 18px; right: 18px; }
    .badge.bottom-left{ bottom: 18px; left: 18px; }
    .badge span{
      font-size: 26px;
      filter: drop-shadow(0 10px 12px rgba(15,23,42,0.20));
    }

    .card-inner{
      position: relative;
      z-index: 1;
      height: 100%;
      padding: 18px;
      display: grid;
      grid-template-rows: auto auto 1fr auto;
      gap: 14px;
    }

    .card-header{
      display:flex;
      align-items:center;
      justify-content:flex-start;
      gap: 10px;
      padding-right: 86px; /* keep header clear of top-right badge */
    }

    .stats{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .chip{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid var(--chip-br);
      background: var(--chip-bg);
      font-size: 12px;
      color: rgba(15,23,42,.80);
      backdrop-filter: blur(10px);
      white-space: nowrap;
    }
    .chip strong{ color: rgba(15,23,42,.95); }

    .mode{
      border: 1px solid var(--panel-br);
      background: rgba(15,23,42,0.03);
      border-radius: 16px;
      padding: 12px 12px 10px;
    }

    .mode-title{
      margin: 0 0 4px;
      font-size: 18px;
      letter-spacing: .2px;
      color: rgba(15,23,42,.95);
    }
    .mode-desc{
      margin: 0;
      color: rgba(15,23,42,.70);
      font-size: 13px;
      line-height: 1.45;
    }

    /* Output panel (fixed size, no layout shift) */
    .output{
      border: 1px solid var(--panel-br);
      background: var(--panel-bg);
      border-radius: 18px;
      padding: 16px 14px;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      min-height: 230px;
      max-height: 230px;
      overflow: auto;
    }

    .text{
      margin: 0;
      font-size: 22px;
      line-height: 1.35;
      color: rgba(15,23,42,.92);
      transition: opacity 220ms ease, transform 220ms ease;
      white-space: pre-line;
    }
    .text.fadeOut{
      opacity: 0;
      transform: translateY(8px);
    }

    .punchline{
      display:block;
      margin-top: 10px;
      font-size: 16px;
      color: rgba(15,23,42,.78);
      opacity: 0;
      transform: translateY(6px);
      transition: opacity 240ms ease, transform 240ms ease;
    }
    .punchline.show{
      opacity: 1;
      transform: translateY(0);
    }

    .card-footer{
      padding-left: 86px; /* keep footer clear of bottom-left badge */
      color: rgba(15,23,42,.62);
      font-size: 12px;
      line-height: 1.4;
      text-align: left;
    }

    /* Inputs */
    .form-row{
      width: 100%;
      max-width: 720px;
      display:grid;
      grid-template-columns: 1.2fr 1fr 1fr 1fr;
      gap: 12px;
      align-items: end;
    }
    label{
      display:block;
      font-size: 12px;
      color: rgba(15,23,42,.72);
      margin-bottom: 6px;
    }
    input, select{
      width: 100%;
      padding: 11px 12px;
      border-radius: 12px;
      border: 1px solid rgba(15,23,42,.12);
      background: rgba(255,255,255,0.74);
      color: rgba(15,23,42,.92);
      outline: none;
      box-shadow: 0 10px 24px rgba(15,23,42,0.08);
    }
    input::placeholder{ color: rgba(15,23,42,.45); }
    input:focus, select:focus{
      border-color: rgba(16, 185, 129, 0.35);
      box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.15), 0 10px 24px rgba(15,23,42,0.08);
    }

    /* Buttons */
    .controls{
      display:flex;
      gap: 12px;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 6px;
    }
    button{
      appearance: none;
      border: 1px solid var(--btn-br);
      background: var(--btn-bg);
      color: rgba(15,23,42,.92);
      padding: 12px 16px;
      border-radius: 14px;
      font-weight: 800;
      letter-spacing: 0.2px;
      cursor: pointer;
      transition: transform 140ms ease, box-shadow 140ms ease, background 140ms ease;
      min-width: 180px;
      box-shadow: 0 14px 34px rgba(15,23,42,0.12);
    }
    button:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,0.86);
      box-shadow: 0 18px 42px rgba(15,23,42,0.14);
    }
    button:active{ transform: translateY(0) scale(0.99); }
    button:focus-visible{
      outline: 3px solid rgba(16, 185, 129, 0.35);
      outline-offset: 3px;
    }

    .secondary-row{
      display:flex;
      gap: 12px;
      justify-content:center;
      flex-wrap: wrap;
      margin-top: 2px;
    }
    .small{ min-width: 180px; }

    .tip{
      margin: 0;
      color: rgba(15,23,42,.62);
      font-size: 12px;
      text-align:center;
      line-height: 1.45;
    }

    @media (max-width: 820px){
      .form-row{ grid-template-columns: 1fr 1fr; }
    }
    @media (max-width: 420px){
      :root{ --card-w: 320px; --card-h: 448px; }
      .form-row{ grid-template-columns: 1fr; }
      .output{ min-height: 210px; max-height: 210px; }
      .text{ font-size: 20px; }
      .badge{ width: 58px; height: 58px; }
      .card-header{ padding-right: 78px; }
      .card-footer{ padding-left: 78px; }
    }
  </style>
</head>

<body>
  <!-- Pastel floating background shapes -->
  <div class="bg-shapes" aria-hidden="true">
    <!-- left dots -->
    <div class="shape circle dot" style="width:20px;height:20px;left:7%;top:42%;background:#FF6B6B;"></div>
    <div class="shape circle" style="width:46px;height:46px;left:12%;top:58%;background:#FFB703;"></div>

    <!-- right cluster -->
    <div class="shape circle" style="width:54px;height:54px;right:12%;top:48%;background:#2ED3C7;"></div>
    <div class="shape circle" style="width:34px;height:34px;right:19%;top:56%;background:#FF6B6B;"></div>
    <div class="shape circle" style="width:18px;height:18px;right:9%;top:60%;background:#FF6B6B;"></div>
    <div class="shape square" style="width:46px;height:46px;right:7%;top:54%;background:#FF6B6B;"></div>
    <div class="shape square" style="width:34px;height:34px;right:15%;top:50%;background:#FFD6E6;"></div>

    <!-- soft bubbles -->
    <div class="shape circle" style="width:90px;height:90px;left:36%;top:18%;background:rgba(255,255,255,0.35);opacity:.35;"></div>
    <div class="shape circle" style="width:120px;height:120px;right:32%;top:22%;background:rgba(255,255,255,0.28);opacity:.30;"></div>
  </div>

  <main class="page">
    <div class="wrap">
      <h1>Compliment &amp; Joke Card</h1>
      <p class="subtitle">
        Generate uplifting compliments or family-friendly jokes‚Äîwrapped in a playful, fixed-size playing card.
      </p>

      <!-- Card -->
      <section class="card" aria-live="polite">
        <div class="badge top-right" id="badgeTR" aria-hidden="true"><span>‚≠ê</span></div>
        <div class="badge bottom-left" id="badgeBL" aria-hidden="true"><span>‚≠ê</span></div>

        <div class="card-inner">
          <div class="card-header">
            <div class="stats">
              <div class="chip">Total: <strong id="totalCount">0</strong></div>
              <div class="chip">Saved: <strong id="savedCount">0</strong></div>
            </div>
          </div>

          <div class="mode">
            <h2 class="mode-title" id="modeTitle">Ready</h2>
            <p class="mode-desc" id="modeDesc">Click a button below to generate a compliment or a joke.</p>
          </div>

          <div class="output" aria-label="Output">
            <p class="text" id="outputText">
              Your next compliment or joke will appear here.
              <span class="punchline" id="punchline"></span>
            </p>
          </div>

          <div class="card-footer" id="cardFooter">
            Fixed-size card ‚Ä¢ Smooth punchlines ‚Ä¢ Clean, pastel theme
          </div>
        </div>
      </section>

      <!-- Inputs -->
      <div class="form-row" aria-label="Personalization">
        <div>
          <label for="name">Name (optional)</label>
          <input id="name" type="text" placeholder="e.g., Hazem" autocomplete="off"/>
        </div>

        <div>
          <label for="role">Who is this for?</label>
          <select id="role">
            <option>Developer</option>
            <option>Designer</option>
            <option>Student</option>
            <option>Manager</option>
            <option>Friend</option>
            <option>Teammate</option>
            <option>Anyone</option>
          </select>
        </div>

        <div>
          <label for="tone">Tone</label>
          <select id="tone">
            <option>Friendly</option>
            <option>Professional</option>
            <option>Playful</option>
          </select>
        </div>

        <div>
          <label for="focus">Focus</label>
          <select id="focus">
            <option>Skills</option>
            <option>Effort</option>
            <option>Creativity</option>
            <option>Leadership</option>
            <option>Kindness</option>
            <option>Progress</option>
          </select>
        </div>
      </div>

      <!-- Buttons outside card -->
      <div class="controls">
        <button id="btnCompliment" type="button">Generate Compliment</button>
        <button id="btnJoke" type="button">Generate Joke</button>
      </div>

      <div class="secondary-row">
        <button class="small" id="btnCopy" type="button">Copy</button>
        <button class="small" id="btnSave" type="button">Save Favorite</button>
      </div>

      <p class="tip">
        Tip: Press <strong>Enter</strong> while focused in a field. Jokes with punchlines reveal after a beat.
      </p>
    </div>
  </main>

  <script>
    // 100 compliments
    const compliments = [
      "You make complicated things feel oddly manageable.",
      "You have ‚Äúcalm in the chaos‚Äù energy.",
      "If competence were contagious, you‚Äôd be a public service announcement.",
      "You‚Äôre the kind of person people trust after one conversation.",
      "Your ideas land smoother than expected‚Äîand stick longer too.",
      "You have great timing, and not just comedically.",
      "You somehow make effort look effortless.",
      "You bring clarity where others bring noise.",
      "You‚Äôd be excellent at explaining things to future humans.",
      "Your curiosity is doing you a lot of favors.",
      "You‚Äôre quietly impressive, which is the best kind.",
      "You ask better questions than most people answer.",
      "You have strong ‚Äúknows what they‚Äôre doing‚Äù vibes.",
      "You make progress even when conditions aren‚Äôt ideal.",
      "You‚Äôre surprisingly good at figuring things out.",
      "Your focus could probably intimidate distractions.",
      "You have a talent for improving whatever you touch.",
      "You make smart choices more often than you realize.",
      "You‚Äôd be a great person to brainstorm with at 2 a.m.",
      "You handle responsibility like a pro.",
      "You have excellent follow-through.",
      "You‚Äôre more prepared than you let on.",
      "Your thinking has depth and direction.",
      "You make learning look rewarding.",
      "You‚Äôre the opposite of careless.",
      "You notice details that actually matter.",
      "You‚Äôd be hard to replace‚Äîand that says a lot.",
      "You balance logic and creativity well.",
      "You‚Äôre someone people trust with important things.",
      "You bring a steady kind of confidence.",
      "You‚Äôre better at this than you think.",
      "You have strong ‚Äúfuture success‚Äù energy.",
      "You make good decisions under pressure.",
      "You‚Äôre impressively consistent.",
      "You improve systems just by being in them.",
      "You‚Äôre very good at making things make sense.",
      "You have a practical kind of intelligence.",
      "You‚Äôre good at turning ideas into action.",
      "You‚Äôre reliable without being boring.",
      "You make progress even on slow days.",
      "You‚Äôre sharper than most people notice at first.",
      "You adapt faster than you give yourself credit for.",
      "You have solid instincts.",
      "You bring structure where it‚Äôs needed most.",
      "You‚Äôre good at learning from experience.",
      "You‚Äôre quietly ambitious‚Äîand it shows.",
      "You make thoughtful choices.",
      "You have a strong sense of direction.",
      "You don‚Äôt just react‚Äîyou respond.",
      "You have excellent judgment.",
      "You‚Äôre good at solving the right problems.",
      "You think things through better than average.",
      "You make steady progress look easy.",
      "You‚Äôre someone people count on.",
      "You bring clarity to uncertainty.",
      "You‚Äôre disciplined in a smart way.",
      "You have a knack for figuring things out.",
      "You‚Äôre more capable than you realize.",
      "You stay composed when it matters.",
      "You‚Äôre surprisingly resourceful.",
      "You make learning feel worthwhile.",
      "You have strong problem-solving instincts.",
      "You‚Äôre good at connecting ideas.",
      "You‚Äôre effective without being flashy.",
      "You make good use of your time.",
      "You‚Äôre thoughtful in how you approach challenges.",
      "You have a clear sense of priorities.",
      "You improve with experience‚Äîand quickly.",
      "You‚Äôre better prepared than most.",
      "You handle complexity well.",
      "You‚Äôre dependable in ways that matter.",
      "You think ahead.",
      "You‚Äôre good at making progress without rushing.",
      "You bring balance to tough situations.",
      "You‚Äôre surprisingly resilient.",
      "You have strong analytical instincts.",
      "You‚Äôre good at adjusting when plans change.",
      "You don‚Äôt waste effort.",
      "You‚Äôre focused in a productive way.",
      "You make good things better.",
      "You‚Äôre efficient without cutting corners.",
      "You have a solid internal compass.",
      "You‚Äôre good at recognizing what matters.",
      "You stay steady when things get tricky.",
      "You learn fast‚Äîand apply it well.",
      "You‚Äôre a strong finisher.",
      "You bring intention to your work.",
      "You‚Äôre more insightful than you let on.",
      "You make smart trade-offs.",
      "You‚Äôre consistently improving.",
      "You have excellent follow-up instincts.",
      "You make thoughtful progress.",
      "You handle responsibility well.",
      "You‚Äôre good at simplifying complexity.",
      "You bring a calm confidence.",
      "You‚Äôre better than average at a lot of things.",
      "You make growth look natural.",
      "You‚Äôre quietly very capable.",
      "You‚Äôre on a solid trajectory.",
      "You‚Äôre doing better than you think."
    ];

    // 50 family-friendly jokes
    const jokes = [
      { setup: "Why did the computer go to the doctor?", punchline: "Because it had a virus!" },
      { setup: "Why don‚Äôt robots get tired?", punchline: "Because they recharge their batteries!" },
      { setup: "Why did the cookie go to the gym?", punchline: "To get a little crunchier." },
      { setup: "What do you call a bear with no teeth?", punchline: "A gummy bear." },
      { setup: "Why did the math book look sad?", punchline: "Because it had too many problems." },
      { setup: "What do you call cheese that isn‚Äôt yours?", punchline: "Nacho cheese." },
      { setup: "Why did the scarecrow get a promotion?", punchline: "Because he was outstanding in his field." },
      { setup: "What do you call a sleeping dinosaur?", punchline: "A dino-snore." },
      { setup: "Why did the bicycle fall over?", punchline: "Because it was two-tired." },
      { setup: "What did one wall say to the other wall?", punchline: "I‚Äôll meet you at the corner." },
      { one: "I‚Äôm reading a book on anti-gravity. It‚Äôs impossible to put down." },
      { one: "Parallel lines have so much in common. It‚Äôs a shame they‚Äôll never meet." },
      { one: "I tried to catch fog yesterday. Mist." },
      { one: "My calendar‚Äôs days are numbered." },
      { one: "I told my pencil a joke‚Ä¶ but it had no point." },
      { setup: "Why did the tomato blush?", punchline: "Because it saw the salad dressing!" },
      { setup: "What do you call a factory that makes okay products?", punchline: "A satisfactory." },
      { setup: "Why did the golfer bring an extra pair of socks?", punchline: "In case he got a hole in one." },
      { setup: "What do you call a boomerang that doesn‚Äôt come back?", punchline: "A stick." },
      { setup: "Why do cows have bells?", punchline: "Because their horns don‚Äôt work." },
      { one: "I used to be a baker‚Ä¶ but I couldn‚Äôt make enough dough." },
      { one: "I‚Äôm great at sleeping. I can do it with my eyes closed." },
      { one: "I tried to organize a hide-and-seek tournament‚Ä¶ but good players are hard to find." },
      { one: "I told my suitcase there would be no vacation this year. Now it‚Äôs dealing with emotional baggage." },
      { one: "I made a belt out of watches‚Ä¶ it was a waist of time." },
      { setup: "Why did the phone wear glasses?", punchline: "Because it lost its contacts." },
      { setup: "What do you call an alligator in a vest?", punchline: "An investigator." },
      { setup: "Why did the banana go to the party?", punchline: "Because it had appeal." },
      { setup: "What did the ocean say to the shore?", punchline: "Nothing‚Äîit just waved." },
      { setup: "Why can‚Äôt you give Elsa a balloon?", punchline: "Because she will let it go." },
      { setup: "Why did the student eat their homework?", punchline: "Because the teacher said it was a piece of cake!" },
      { setup: "What do you call a lazy kangaroo?", punchline: "A pouch potato." },
      { setup: "Why did the astronaut break up with the moon?", punchline: "It needed space." },
      { setup: "What do you call a snowman with a six-pack?", punchline: "An abdominal snowman." },
      { setup: "Why did the computer sit on the floor?", punchline: "It wanted to keep an eye on its cookies." },
      { one: "I used to play piano by ear‚Ä¶ now I use my hands." },
      { one: "If you see a crime at the Apple Store, does that make you an iWitness?" },
      { one: "I told a joke about a roof‚Ä¶ but it went over everyone‚Äôs head." },
      { one: "I‚Äôm on a seafood diet. I see food and I eat it." },
      { one: "I used to be afraid of hurdles‚Ä¶ but I got over it." },
      { one: "I tried to write a time-travel joke‚Ä¶ but you didn‚Äôt like it." },
      { one: "I told my keyboard a joke‚Ä¶ it couldn‚Äôt stop typing." },
      { one: "I‚Äôm friends with all electricians. We have good current connections." },
      { one: "I tried to take a photo of a wheat field‚Ä¶ but it was too grainy." },
      { one: "I asked the librarian about books on paranoia‚Ä¶ she whispered: ‚ÄòThey‚Äôre right behind you.‚Äô" }
    ];

    const badgeIcons = ["‚≠ê","‚ú®","üåü","üí´","üéØ","üß†","üçÄ","ü¶Ñ","üéâ","üíõ","üåà","üöÄ"];

    const randomInt = (max) => Math.floor(Math.random() * max);

    function makeBag(items){
      let bag = [];
      function refill(){
        bag = items.slice();
        for (let i = bag.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [bag[i], bag[j]] = [bag[j], bag[i]];
        }
      }
      refill();
      return {
        next(){
          if (bag.length === 0) refill();
          return bag.pop();
        }
      };
    }

    const complimentBag = makeBag(compliments);
    const jokeBag = makeBag(jokes);

    // state
    let total = 0;
    let saved = 0;
    let favorites = [];
    let punchTimer = null;
    let lastTextForCopy = "";

    // elements
    const badgeTR = document.getElementById("badgeTR");
    const badgeBL = document.getElementById("badgeBL");
    const modeTitle = document.getElementById("modeTitle");
    const modeDesc = document.getElementById("modeDesc");
    const outputText = document.getElementById("outputText");
    const punchlineEl = document.getElementById("punchline");
    const totalEl = document.getElementById("totalCount");
    const savedEl = document.getElementById("savedCount");

    const nameEl = document.getElementById("name");
    const roleEl = document.getElementById("role");
    const toneEl = document.getElementById("tone");
    const focusEl = document.getElementById("focus");

    const btnCompliment = document.getElementById("btnCompliment");
    const btnJoke = document.getElementById("btnJoke");
    const btnCopy = document.getElementById("btnCopy");
    const btnSave = document.getElementById("btnSave");

    function randomBadgeIcon(){
      return badgeIcons[randomInt(badgeIcons.length)];
    }

    function refreshBadges(){
      badgeTR.innerHTML = `<span>${randomBadgeIcon()}</span>`;
      badgeBL.innerHTML = `<span>${randomBadgeIcon()}</span>`;
    }

    function clearPunchline(){
      if (punchTimer) clearTimeout(punchTimer);
      punchTimer = null;
      punchlineEl.textContent = "";
      punchlineEl.classList.remove("show");
    }

    function animateSwap(mainText){
      outputText.classList.add("fadeOut");
      clearPunchline();
      setTimeout(() => {
        outputText.childNodes[0].textContent = mainText;
        outputText.classList.remove("fadeOut");
      }, 220);
    }

    function incTotal(){
      total++;
      totalEl.textContent = total;
    }

    function buildPersonalPrefix(){
      const name = (nameEl.value || "").trim();
      const role = roleEl.value;
      const tone = toneEl.value;
      const focus = focusEl.value;

      const parts = [];
      if (name) parts.push(name);
      if (role && role !== "Anyone") parts.push(role);

      const who = parts.length ? parts.join(" ‚Ä¢ ") : "You";
      return { who, tone, focus };
    }

    function personalize(raw){
      const { who } = buildPersonalPrefix();
      return `${who}: ${raw}`;
    }

    function showCompliment(){
      refreshBadges();
      incTotal();
      modeTitle.textContent = "Compliment";
      modeDesc.textContent = "Uplifting, family-friendly compliments. Fixed card size.";

      const raw = complimentBag.next();
      const text = personalize(raw);
      lastTextForCopy = text;
      animateSwap(text);
    }

    function showJoke(){
      refreshBadges();
      incTotal();
      modeTitle.textContent = "Joke";
      modeDesc.textContent = "Family-friendly humor. Punchlines appear after a beat when available.";

      const j = jokeBag.next();
      if (j.one){
        lastTextForCopy = j.one;
        animateSwap(j.one);
        return;
      }

      lastTextForCopy = `${j.setup}\n${j.punchline}`;
      animateSwap(j.setup);

      punchTimer = setTimeout(() => {
        punchlineEl.textContent = j.punchline;
        punchlineEl.classList.add("show");
      }, 1500);
    }

    async function copyToClipboard(){
      const text = lastTextForCopy || "";
      if (!text) return;
      try{
        await navigator.clipboard.writeText(text);
        btnCopy.textContent = "Copied!";
        setTimeout(() => (btnCopy.textContent = "Copy"), 900);
      } catch {
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        document.body.removeChild(ta);
        btnCopy.textContent = "Copied!";
        setTimeout(() => (btnCopy.textContent = "Copy"), 900);
      }
    }

    function saveFavorite(){
      const text = lastTextForCopy || "";
      if (!text) return;

      if (!favorites.includes(text)){
        favorites.push(text);
        saved++;
        savedEl.textContent = saved;
        btnSave.textContent = "Saved!";
        setTimeout(() => (btnSave.textContent = "Save Favorite"), 900);
      } else {
        btnSave.textContent = "Already saved";
        setTimeout(() => (btnSave.textContent = "Save Favorite"), 900);
      }
    }

    btnCompliment.addEventListener("click", showCompliment);
    btnJoke.addEventListener("click", showJoke);
    btnCopy.addEventListener("click", copyToClipboard);
    btnSave.addEventListener("click", saveFavorite);

    // keyboard shortcuts
    let lastMode = "compliment";
    btnCompliment.addEventListener("click", () => lastMode = "compliment");
    btnJoke.addEventListener("click", () => lastMode = "joke");

    document.addEventListener("keydown", (e) => {
      if (e.key === "Enter"){
        const tag = document.activeElement?.tagName?.toLowerCase();
        if (tag === "input" || tag === "select"){
          lastMode === "joke" ? showJoke() : showCompliment();
        }
      }
      const k = e.key.toLowerCase();
      if (k === "c") showCompliment();
      if (k === "j") showJoke();
    });

    // init
    refreshBadges();
  </script>
</body>
</html>
